{"version":3,"file":"index.js","sources":["index.ts"],"sourcesContent":["import {documentEventHandler} from '@sanity/functions'\nimport process from 'node:process'\n\nconst {BOT_TOKEN, CHAT_ID} = process.env\n\nexport const handler = documentEventHandler(async ({event}) => {\n  const {_id, content: comment} = event.data\n\n  if (!comment) {\n    console.log('No comment in event data')\n    return\n  } else if (!BOT_TOKEN || !CHAT_ID) {\n    console.log('Environment variables not set')\n    return\n  }\n\n  try {\n    const message = `New comment received: ${comment}`\n    const studioUrl = `https://studio.simeongriggs.dev/structure/comment;${_id}`\n\n    const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        chat_id: CHAT_ID,\n        text: message,\n        reply_markup: {\n          inline_keyboard: [[{text: 'üìù Open in Sanity Studio', url: studioUrl}]],\n        },\n      }),\n    })\n\n    if (!response.ok) {\n      throw new Error(`Telegram API error: ${response.status} ${response.statusText}`)\n    }\n\n    const result = await response.json()\n    console.log('Message sent successfully:', result)\n  } catch (error) {\n    console.error('Failed to send Telegram notification:', error)\n    throw error\n  }\n})\n"],"names":[],"mappings":";;AAGA,MAAM,EAAC,WAAW,YAAW,QAAQ;AAE9B,MAAM,UAAU,qBAAqB,OAAO,EAAC,YAAW;AAC7D,QAAM,EAAC,KAAK,SAAS,QAAA,IAAW,MAAM;AAEtC,MAAI,CAAC,SAAS;AACZ,YAAQ,IAAI,0BAA0B;AACtC;AAAA,EACF,WAAW,CAAC,aAAa,CAAC,SAAS;AACjC,YAAQ,IAAI,+BAA+B;AAC3C;AAAA,EACF;AAEA,MAAI;AACF,UAAM,UAAU,yBAAyB,OAAO;AAChD,UAAM,YAAY,qDAAqD,GAAG;AAE1E,UAAM,WAAW,MAAM,MAAM,+BAA+B,SAAS,gBAAgB;AAAA,MACnF,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,gBAAgB;AAAA,MAAA;AAAA,MAElB,MAAM,KAAK,UAAU;AAAA,QACnB,SAAS;AAAA,QACT,MAAM;AAAA,QACN,cAAc;AAAA,UACZ,iBAAiB,CAAC,CAAC,EAAC,MAAM,4BAA4B,KAAK,WAAU,CAAC;AAAA,QAAA;AAAA,MACxE,CACD;AAAA,IAAA,CACF;AAED,QAAI,CAAC,SAAS,IAAI;AAChB,YAAM,IAAI,MAAM,uBAAuB,SAAS,MAAM,IAAI,SAAS,UAAU,EAAE;AAAA,IACjF;AAEA,UAAM,SAAS,MAAM,SAAS,KAAA;AAC9B,YAAQ,IAAI,8BAA8B,MAAM;AAAA,EAClD,SAAS,OAAO;AACd,YAAQ,MAAM,yCAAyC,KAAK;AAC5D,UAAM;AAAA,EACR;AACF,CAAC;"}